<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AppMeeting - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .hidden-section { display: none !important; }
        .nav-btn.active { background-color: #eff6ff; color: #4f46e5; border-right: 4px solid #4f46e5; font-weight: 600; }
        .equip input:checked + div {
            background: #eef2ff; border-color: #6366f1; color: #4338ca; font-weight: 600;
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #bookingModal { z-index: 50 !important; }
        .mobile-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
    </style>
</head>
<body class="h-screen overflow-hidden text-gray-700 bg-gray-50">
    <script>
        // URL ‡∏Ç‡∏≠‡∏á Server Online (Render)
        const API_BASE_URL = 'https://webappmeeting-fixenv.onrender.com/api'; 
    </script>
    
    <!-- LOGIN SCREEN -->
    <div id="authSection" class="h-full flex items-center justify-center bg-slate-900 relative overflow-hidden">
        <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1920&q=80')] bg-cover bg-center"></div>
        
        <!-- Login Form -->
        <div id="loginCard" class="bg-white/95 backdrop-blur p-8 rounded-3xl shadow-2xl w-full max-w-sm relative z-10 mx-4 fade-in">
            <h2 class="text-3xl font-bold text-center mb-2 text-indigo-700">AppMeeting</h2>
            <p class="text-center text-gray-400 text-sm mb-6">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
            
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">USERNAME</label>
                    <input id="lUser" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">PASSWORD</label>
                    <input id="lPass" type="password" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                <div class="flex justify-end">
                    <a href="javascript:void(0)" onclick="handleForgotPassword()" class="text-xs text-indigo-600 hover:underline">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</a>
                </div>
                <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg transform active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
             <p class="text-center mt-6 text-sm text-gray-500">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <a href="javascript:void(0)" onclick="toggleAuth('register')" class="text-indigo-600 font-bold hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
            </p>
        </div>

        <!-- Register Form -->
        <div id="registerCard" class="hidden-section bg-white/95 backdrop-blur p-8 rounded-3xl shadow-2xl w-full max-w-sm relative z-10 mx-4 fade-in">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-emerald-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</h2>
                <p class="text-gray-400 text-sm">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            <form onsubmit="handleRegister(event)" class="space-y-3">
                <input id="rName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required class="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:ring-2 ring-emerald-500">
                <input id="rUser" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)" required class="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:ring-2 ring-emerald-500">
                <input id="rEmail" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email)" required class="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:ring-2 ring-emerald-500">
                <input id="rPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required class="w-full p-3 bg-gray-50 rounded-xl border outline-none focus:ring-2 ring-emerald-500">
                <button type="submit" class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-emerald-700 transition transform active:scale-95">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            </form>
            <p class="text-center mt-6 text-sm text-gray-500">
                ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß? <a href="javascript:void(0)" onclick="toggleAuth('login')" class="text-indigo-600 font-bold hover:underline">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
            </p>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="appSection" class="hidden-section flex h-full relative">
        <!-- Sidebar Overlay for Mobile -->
        <div id="sidebarOverlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

        <!-- Sidebar -->
        <aside class="fixed lg:static inset-y-0 left-0 w-72 bg-white shadow-xl z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 flex flex-col border-r border-gray-100" id="sidebar">
            <div class="p-6 border-b flex justify-between items-center bg-white">
                <h1 class="font-bold text-xl text-indigo-600 tracking-tight flex items-center gap-2">
                    <i class="fas fa-layer-group"></i> AppMeeting
                </h1>
                <button onclick="toggleSidebar()" class="lg:hidden text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- User Profile Widget -->
            <div class="p-6 text-center border-b bg-gradient-to-b from-white to-slate-50 cursor-pointer hover:bg-slate-50 transition" onclick="renderPage('profile')">
                <div class="relative inline-block group">
                    <img id="sideAvatar" src="" class="w-20 h-20 rounded-full mx-auto mb-3 object-cover border-4 border-white shadow-md bg-gray-200" onerror="this.src='https://ui-avatars.com/api/?name=User&background=random'">
                    <div class="absolute inset-0 bg-black/30 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition text-white text-xs font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</div>
                </div>
                <h3 id="sideName" class="font-bold text-gray-800 text-lg leading-tight truncate px-2">...</h3>
                <span id="sideRole" class="text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-gray-400">...</span>
            </div>

            <nav class="flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar">
                <p class="px-3 text-[10px] font-bold text-gray-400 uppercase mb-2 mt-2">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</p>
                <button onclick="renderPage('home')" class="nav-btn active w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="home">
                    <div class="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center"><i class="fas fa-home"></i></div>
                    ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
                <button onclick="renderPage('calendar')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="calendar">
                    <div class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fas fa-calendar-alt"></i></div>
                    ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                </button>
                <button onclick="openBookingModal()" class="w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm group">
                    <div class="w-8 h-8 rounded-lg bg-indigo-600 text-white flex items-center justify-center shadow-md group-hover:scale-110 transition"><i class="fas fa-plus"></i></div>
                    <span class="font-bold text-indigo-700">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</span>
                </button>
                <button onclick="renderPage('history')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="history">
                    <div class="w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center"><i class="fas fa-history"></i></div>
                    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
                <button onclick="renderPage('profile')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="profile">
                    <div class="w-8 h-8 rounded-lg bg-slate-100 text-slate-600 flex items-center justify-center"><i class="fas fa-user-cog"></i></div>
                    ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                </button>
                
                <!-- Admin Menu -->
                <div id="adminMenu" class="hidden-section mt-6 pt-4 border-t border-dashed">
                    <p class="px-3 text-[10px] font-bold text-gray-400 uppercase mb-2">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                    <button onclick="renderPage('approve')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-orange-50 text-orange-600 flex gap-3 items-center text-sm" data-page="approve">
                        <div class="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center"><i class="fas fa-tasks"></i></div>
                        ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á <span id="badgePending" class="hidden ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full">0</span>
                    </button>
                    <button onclick="renderPage('rooms')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-teal-50 text-teal-600 flex gap-3 items-center text-sm" data-page="rooms">
                        <div class="w-8 h-8 rounded-lg bg-teal-100 text-teal-600 flex items-center justify-center"><i class="fas fa-door-open"></i></div>
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á
                    </button>
                    <button onclick="renderPage('users')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-blue-50 text-blue-600 flex gap-3 items-center text-sm" data-page="users">
                        <div class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fas fa-users-cog"></i></div>
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    </button>
                </div>
            </nav>
            <div class="p-4 border-t bg-gray-50 mobile-safe-bottom">
                <button onclick="logout()" class="w-full text-gray-500 hover:text-red-500 hover:bg-red-50 p-2 rounded-xl font-bold text-sm transition flex items-center justify-center gap-2">
                    <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-slate-50 overflow-hidden relative w-full">
            <header class="h-16 bg-white border-b px-4 lg:px-6 flex items-center justify-between sticky top-0 z-10 shadow-sm flex-shrink-0">
                <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 text-gray-600"><i class="fas fa-bars"></i></button>
                    <h2 id="pageTitle" class="text-lg lg:text-xl font-bold text-gray-800 truncate">Dashboard</h2>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden md:block">
                        <p id="dateDisplay" class="text-sm font-bold text-gray-700"></p>
                    </div>
                </div>
            </header>
            
            <div id="contentArea" class="flex-1 p-4 lg:p-8 overflow-y-auto pb-20 custom-scrollbar">
                <!-- Content Injected Here -->
                <div class="flex items-center justify-center h-full text-gray-400">
                    <i class="fas fa-circle-notch fa-spin text-3xl"></i>
                </div>
            </div>
        </main>
    </div>

    <!-- BOOKING MODAL -->
    <div id="bookingModal" class="hidden fixed inset-0 bg-slate-900/70 backdrop-blur-sm flex items-center justify-center p-0 lg:p-4 z-50">
        <div class="bg-white w-full lg:max-w-5xl h-full lg:h-[85vh] lg:rounded-3xl shadow-2xl flex flex-col md:flex-row overflow-hidden fade-in">
            <!-- Mobile Header for Modal -->
            <div class="lg:hidden p-4 border-b flex justify-between items-center bg-white flex-shrink-0">
                <h3 class="font-bold text-lg">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"><i class="fas fa-times"></i></button>
            </div>

            <!-- Left: Form -->
            <div class="w-full md:w-1/3 bg-slate-50 p-6 md:p-8 border-r overflow-y-auto flex flex-col">
                <h3 class="hidden lg:block text-xl font-bold mb-1 text-gray-800">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h3>
                <p class="hidden lg:block text-xs text-gray-400 mb-6">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</p>
                
                <div class="space-y-4 flex-1">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="text-red-500">*</span></label>
                        <input id="bkTopic" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô..." class="w-full p-3 border rounded-xl focus:ring-2 ring-indigo-500 outline-none bg-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
                        <input id="bkPeople" type="number" min="1" value="5" class="w-full p-3 border rounded-xl outline-none bg-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå (PDF/‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)</label>
                        <input id="bkFile" type="file" accept=".pdf,.jpg,.png,.jpeg" class="w-full text-xs file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="text-red-500">*</span></label>
                            <input id="bkStart" type="datetime-local" class="w-full p-3 border rounded-xl outline-none bg-white">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <select id="bkDuration" class="w-full p-3 border rounded-xl outline-none bg-white">
                                <option value="1">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="2" selected>2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="3">3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="4">4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="8">‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô (8 ‡∏ä‡∏°.)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-2">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="equip"><input type="checkbox" value="WiFi" checked hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-wifi mr-1"></i> WiFi</div></label>
                            <label class="equip"><input type="checkbox" value="Projector" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-video mr-1"></i> Projector</div></label>
                            <label class="equip"><input type="checkbox" value="Whiteboard" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-chalkboard mr-1"></i> Board</div></label>
                            <label class="equip"><input type="checkbox" value="Snack" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-cookie-bite mr-1"></i> Snack</div></label>
                        </div>
                    </div>
                </div>
                
                <div class="hidden lg:block pt-4 mt-4 border-t">
                    <button onclick="closeModal()" class="w-full py-2 text-gray-400 text-sm font-bold hover:text-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
            
            <!-- Right: Room Select -->
            <div class="w-full md:w-2/3 bg-white p-4 lg:p-8 flex flex-col relative flex-1 overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-bold text-gray-700 text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h4>
                    <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full whitespace-nowrap"><i class="fas fa-check-circle mr-1"></i>‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</span>
                </div>
                <div id="roomList" class="flex-1 overflow-y-auto space-y-3 pb-20 custom-scrollbar">
                    <!-- Room Items Injected Here -->
                    <p class="text-center text-gray-400 mt-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN SCRIPT -->
    <script>
        // --- GLOBAL STATE ---
        let currentUser = null;
        let allBookings = [];
        let allRooms = [];
        
        const $ = id => document.getElementById(id);

        // --- INIT ---
        window.onload = async () => {
            const savedUser = localStorage.getItem('am_user');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                await initUI();
            } else {
                $('authSection').classList.remove('hidden-section');
            }
            updateClock();
            setInterval(updateClock, 60000);
        };

        function updateClock() {
            const now = new Date();
            if($('dateDisplay')) $('dateDisplay').innerText = now.toLocaleDateString('th-TH', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
        }

        // --- AUTH ---
        function toggleAuth(mode) {
            if(mode === 'register') {
                $('loginCard').classList.add('hidden-section');
                $('registerCard').classList.remove('hidden-section');
            } else {
                $('registerCard').classList.add('hidden-section');
                $('loginCard').classList.remove('hidden-section');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const u = $('lUser').value.trim();
            const p = $('lPass').value.trim();
            
            try {
                const res = await fetch(`${API_BASE_URL}/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ username: u, password: p })
                });
                const data = await res.json();
                
                if(data.success) {
                    currentUser = data.user;
                    localStorage.setItem('am_user', JSON.stringify(currentUser));
                    await initUI();
                } else {
                    Swal.fire('Login Failed', data.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î', 'error');
                }
            } catch (err) {
                console.error(err);
                Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏î‡πâ', 'error');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const payload = {
                fullname: $('rName').value.trim(),
                username: $('rUser').value.trim(),
                email: $('rEmail').value.trim(),
                password: $('rPass').value.trim()
            };

            try {
                const res = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                
                if(data.success) {
                    Swal.fire('Success', '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'success');
                    toggleAuth('login');
                } else {
                    Swal.fire('Error', data.message || '‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
                }
            } catch (err) {
                Swal.fire('Error', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error');
            }
        }

        async function handleForgotPassword() {
            const { value: formValues } = await Swal.fire({
                title: '‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô',
                html:
                    '<input id="swal-user" class="swal2-input" placeholder="Username">' +
                    '<input id="swal-email" class="swal2-input" placeholder="Email">' +
                    '<input id="swal-newpass" type="password" class="swal2-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà">',
                focusConfirm: false,
                showCancelButton: true,
                preConfirm: () => {
                    return {
                        username: document.getElementById('swal-user').value,
                        email: document.getElementById('swal-email').value,
                        newPassword: document.getElementById('swal-newpass').value
                    }
                }
            });

            if (formValues) {
                try {
                    const res = await fetch(`${API_BASE_URL}/reset-password`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(formValues)
                    });
                    const data = await res.json();
                    if(data.success) {
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà', 'success');
                    } else {
                        Swal.fire('‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', data.message || '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                    }
                } catch(e) { Swal.fire('Error', 'Connection Failed', 'error'); }
            }
        }

        function logout() {
            localStorage.removeItem('am_user');
            location.reload();
        }

        // --- UTILS FOR AVATAR ---
        function getAvatarUrl(user) {
            if (user.avatar && user.avatar !== 'default.png') {
                return `${API_BASE_URL.replace('/api', '')}/uploads/${user.avatar}`;
            }
            // ‡πÉ‡∏ä‡πâ UI Avatar ‡πÄ‡∏õ‡πá‡∏ô default ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ
            return `https://ui-avatars.com/api/?name=${user.fullname}&background=random&color=fff`;
        }

        // --- UI & DATA FETCHING ---
        async function initUI() {
            $('authSection').classList.add('hidden-section');
            $('appSection').classList.remove('hidden-section');
            
            // Profile setup
            $('sideName').innerText = currentUser.fullname;
            $('sideAvatar').src = getAvatarUrl(currentUser);

            const roleEl = $('sideRole');
            if(currentUser.role === 'admin') {
                roleEl.innerText = 'Admin';
                roleEl.className = 'text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-indigo-600 shadow-indigo-200 shadow-lg';
                $('adminMenu').classList.remove('hidden-section');
            } else {
                roleEl.innerText = 'User';
                roleEl.className = 'text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-gray-400';
            }

            await renderPage('home');
        }

        async function fetchBookings() {
            const res = await fetch(`${API_BASE_URL}/bookings`);
            allBookings = await res.json();
            
            // Update badge
            if(currentUser.role === 'admin') {
                const pending = allBookings.filter(b => b.status === 'pending').length;
                const badge = $('badgePending');
                badge.innerText = pending;
                if(pending > 0) badge.classList.remove('hidden'); else badge.classList.add('hidden');
            }
            return allBookings;
        }

        async function fetchRooms() {
            const res = await fetch(`${API_BASE_URL}/admin/rooms`);
            allRooms = await res.json();
            return allRooms;
        }

        // --- PAGE RENDERING ---
        async function renderPage(page) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.page === page) btn.classList.add('active');
            });
            
            if(window.innerWidth < 1024) {
                 const sb = $('sidebar');
                 if(!sb.classList.contains('-translate-x-full')) toggleSidebar();
            }

            const content = $('contentArea');
            content.innerHTML = '<div class="flex items-center justify-center h-full"><i class="fas fa-circle-notch fa-spin text-3xl text-indigo-500"></i></div>';
            
            $('pageTitle').innerText = 
                page === 'home' ? '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å' :
                page === 'calendar' ? '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' :
                page === 'history' ? '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' :
                page === 'approve' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á' :
                page === 'users' ? '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ' : 
                page === 'profile' ? '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå' : '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°';

            try {
                await fetchBookings();
                
                if(page === 'home') renderDashboard();
                else if(page === 'calendar') renderCalendarPage();
                else if(page === 'history') renderHistory();
                else if(page === 'approve') renderApprove();
                else if(page === 'rooms') renderRooms();
                else if(page === 'users') renderUsers();
                else if(page === 'profile') renderProfile();

            } catch(e) {
                console.error(e);
                content.innerHTML = '<div class="text-red-500 text-center mt-10">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
            }
        }

        function renderDashboard() {
            const myBookings = allBookings.filter(b => b.user_id === currentUser.id);
            const pendingCount = allBookings.filter(b => b.status === 'pending').length;
            const now = new Date();
            const isAdmin = currentUser.role === 'admin';
            
            const nextMeeting = myBookings
                .filter(b => b.status === 'approved' && new Date(b.start_time) > now)
                .sort((a, b) => new Date(a.start_time) - new Date(b.start_time))[0];

            let html = `<div class="fade-in max-w-6xl mx-auto space-y-6">`;
            
            html += `<div class="grid grid-cols-1 ${isAdmin ? 'lg:grid-cols-3' : 'lg:grid-cols-1'} gap-6">`;
            
            html += `
                <div class="${isAdmin ? 'lg:col-span-2' : ''} bg-gradient-to-r from-indigo-600 to-blue-600 rounded-3xl p-6 lg:p-8 text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h2 class="text-2xl lg:text-3xl font-bold mb-2">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ‡∏Ñ‡∏∏‡∏ì${currentUser.fullname.split(' ')[0]} üëã</h2>
                        <p class="text-indigo-100 mb-6 lg:mb-8">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                        
                        ${nextMeeting ? `
                            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 lg:p-6 border border-white/20 inline-block w-full lg:w-auto min-w-[300px]">
                                <div class="flex items-center gap-3 mb-2 text-indigo-200 text-xs font-bold uppercase tracking-wider">
                                    <i class="fas fa-calendar-day"></i> ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                                </div>
                                <h3 class="text-xl lg:text-2xl font-bold mb-2 truncate">${nextMeeting.topic}</h3>
                                <div class="flex flex-wrap gap-4 text-sm">
                                    <span class="flex items-center gap-2"><i class="far fa-clock"></i> ${new Date(nextMeeting.start_time).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})}</span>
                                    <span class="flex items-center gap-2"><i class="fas fa-map-marker-alt"></i> ${nextMeeting.room_name}</span>
                                </div>
                            </div>
                        ` : `
                            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 flex items-center gap-4 inline-flex">
                                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl">‚òï</div>
                                <div>
                                    <h3 class="font-bold text-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</h3>
                                    <p class="text-sm text-indigo-100">‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á! ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                                </div>
                            </div>
                        `}
                    </div>
                    <div class="absolute right-0 top-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/4 blur-3xl"></div>
                </div>`;
            
            if (isAdmin) {
                html += `
                <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center">
                    <h4 class="font-bold text-gray-700 mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center"><i class="fas fa-check"></i></div>
                                <div>
                                    <p class="text-xs text-gray-500 font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                    <p class="font-bold text-gray-800">${myBookings.filter(b=>b.status==='approved').length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-orange-50 rounded-xl">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center"><i class="fas fa-clock"></i></div>
                                <div>
                                    <p class="text-xs text-gray-500 font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                    <p class="font-bold text-gray-800">${myBookings.filter(b=>b.status==='pending').length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-3 bg-slate-900 text-white rounded-xl text-center cursor-pointer hover:bg-slate-800 transition" onclick="renderPage('approve')">
                            <p class="text-xs text-gray-400">ADMIN PANEL</p>
                            <p class="font-bold">‡∏£‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ${pendingCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        </div>
                    </div>
                </div>`;
            }

            html += `</div>`; 
            
            html += `
                <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h3 class="font-bold text-gray-800">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                        <button onclick="renderPage('history')" class="text-sm text-indigo-600 hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm whitespace-nowrap">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4 pl-6">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                    <th class="p-4">‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th class="p-4">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="p-4 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${myBookings.length > 0 ? myBookings.slice(0, 5).map(b => `
                                    <tr class="hover:bg-slate-50 transition">
                                        <td class="p-4 pl-6 font-bold text-gray-700">${b.topic}</td>
                                        <td class="p-4 text-gray-600">${b.room_name}</td>
                                        <td class="p-4 text-gray-500 text-xs">
                                            ${new Date(b.start_time).toLocaleDateString('th-TH', {day:'numeric',month:'short'})}<br>
                                            ${new Date(b.start_time).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})} - ${new Date(b.end_time).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})}
                                        </td>
                                        <td class="p-4 text-center">${getStatusBadge(b.status)}</td>
                                    </tr>
                                `).join('') : `<tr><td colspan="4" class="p-8 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</td></tr>`}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
            
            $('contentArea').innerHTML = html;
        }

        function renderCalendarPage() {
            $('contentArea').innerHTML = `
                <div class="bg-white p-2 lg:p-4 rounded-3xl shadow-sm border h-[calc(100vh-140px)] fade-in flex flex-col">
                    <div id="calendar" class="flex-1"></div>
                </div>`;
            
            // --- FILTER LOGIC ---
            // ‡∏ñ‡πâ‡∏≤ User: ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
            // ‡∏ñ‡πâ‡∏≤ Admin: ‡πÄ‡∏≠‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            let displayEvents = allBookings;
            if (currentUser.role !== 'admin') {
                displayEvents = allBookings.filter(b => b.user_id === currentUser.id);
            }

            const events = displayEvents.map(b => {
                const isMine = b.user_id === currentUser.id;
                let color = '#9ca3af'; 
                
                if (b.status === 'approved') {
                    color = isMine ? '#4f46e5' : '#10b981'; 
                } else if (b.status === 'pending') {
                    color = '#f59e0b';
                } else if (b.status === 'rejected') {
                    color = '#ef4444'; 
                }

                return {
                    id: b.id,
                    title: `${b.topic} (${b.room_name})`,
                    start: b.start_time,
                    end: b.end_time,
                    backgroundColor: color,
                    borderColor: 'transparent',
                    extendedProps: { 
                        status: b.status, 
                        user: b.fullname, 
                        room: b.room_name,
                        isMine: isMine 
                    }
                };
            });

            setTimeout(() => {
                const calendarEl = document.getElementById('calendar');
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: window.innerWidth < 768 ? 'listWeek' : 'timeGridWeek',
                    locale: 'th',
                    headerToolbar: { 
                        left: 'prev,next', 
                        center: 'title', 
                        right: 'dayGridMonth,timeGridWeek,listWeek' 
                    },
                    events: events,
                    height: '100%',
                    slotMinTime: '08:00:00',
                    slotMaxTime: '19:00:00',
                    allDaySlot: false,
                    expandRows: true,
                    eventClick: function(info) {
                        const props = info.event.extendedProps;
                        Swal.fire({
                            title: info.event.title,
                            html: `
                                <div class="text-left text-sm">
                                    <p><b>‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</b> ${props.user}</p>
                                    <p><b>‡∏´‡πâ‡∏≠‡∏á:</b> ${props.room}</p>
                                    <p><b>‡πÄ‡∏ß‡∏•‡∏≤:</b> ${info.event.start.toLocaleTimeString('th-TH')} - ${info.event.end.toLocaleTimeString('th-TH')}</p>
                                    <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${props.status}</p>
                                </div>
                            `,
                            icon: 'info'
                        });
                    }
                });
                calendar.render();
            }, 100);
        }
        
        function renderProfile() {
            let html = `
            <div class="max-w-2xl mx-auto bg-white rounded-3xl shadow-sm border p-8 fade-in">
                <h3 class="font-bold text-2xl mb-6 text-gray-800">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
                
                <div class="flex flex-col items-center mb-8">
                    <div class="relative group">
                        <img id="previewAvatar" src="${getAvatarUrl(currentUser)}" class="w-32 h-32 rounded-full object-cover border-4 border-indigo-50 shadow-lg">
                        <label for="uploadAvatar" class="absolute bottom-0 right-0 w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center cursor-pointer shadow hover:bg-indigo-700 transition">
                            <i class="fas fa-camera"></i>
                        </label>
                        <input type="file" id="uploadAvatar" class="hidden" accept="image/*" onchange="previewImage(event)">
                    </div>
                    <p class="mt-4 font-bold text-lg">${currentUser.fullname}</p>
                    <p class="text-gray-400 text-sm">@${currentUser.username}</p>
                </div>

                <form onsubmit="handleUpdateProfile(event)" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input id="pfName" value="${currentUser.fullname}" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition" required>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
                        <input id="pfPass" type="password" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition">
                    </div>
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</button>
                    </div>
                </form>
            </div>
            `;
            $('contentArea').innerHTML = html;
        }

        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = () => $('previewAvatar').src = reader.result;
            reader.readAsDataURL(event.target.files[0]);
        }

        async function handleUpdateProfile(e) {
            e.preventDefault();
            const formData = new FormData();
            formData.append('id', currentUser.id);
            formData.append('fullname', $('pfName').value);
            
            const pass = $('pfPass').value;
            formData.append('password', pass ? pass : currentUser.password);

            const fileInput = $('uploadAvatar');
            if(fileInput.files[0]) {
                formData.append('avatar', fileInput.files[0]);
            }

            try {
                const res = await fetch(`${API_BASE_URL}/profile`, { method: 'POST', body: formData });
                const data = await res.json();
                if(data.success) {
                    currentUser = data.user;
                    localStorage.setItem('am_user', JSON.stringify(currentUser));
                    Swal.fire('Success', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    initUI(); // Refresh Sidebar
                } else {
                    Swal.fire('Error', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
                }
            } catch(err) { Swal.fire('Error', 'Connection Error', 'error'); }
        }

        async function renderHistory() {
            const bookings = currentUser.role === 'admin' 
                ? allBookings 
                : allBookings.filter(b => b.user_id === currentUser.id);

            let html = `
                <div class="bg-white rounded-3xl shadow-sm border p-6 fade-in">
                    <h3 class="font-bold text-lg mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ${currentUser.role === 'admin' ? '(‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)' : '(‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô)'}</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm whitespace-nowrap">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="p-4">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="p-4">‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</th>
                                    <th class="p-4">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                    <th class="p-4">‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th class="p-4">‡πÑ‡∏ü‡∏•‡πå</th>
                                    <th class="p-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="p-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${bookings.map(b => `
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-4">${new Date(b.start_time).toLocaleDateString('th-TH')}</td>
                                        <td class="p-4">${new Date(b.start_time).toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})} - ${new Date(b.end_time).toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})}</td>
                                        <td class="p-4 text-gray-600">${b.fullname}</td>
                                        <td class="p-4 font-bold text-gray-700">${b.topic}</td>
                                        <td class="p-4">${b.room_name}</td>
                                        <td class="p-4">
                                            ${b.document ? `<a href="${API_BASE_URL.replace('/api','')}/uploads/${b.document}" target="_blank" class="text-indigo-600 hover:underline"><i class="fas fa-paperclip"></i> ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå</a>` : '-'}
                                        </td>
                                        <td class="p-4">${getStatusBadge(b.status)}</td>
                                        <td class="p-4">
                                            ${(b.status === 'pending' && (b.user_id === currentUser.id || currentUser.role === 'admin')) 
                                                ? `<button onclick="deleteBooking(${b.id})" class="text-red-500 hover:bg-red-50 px-3 py-1 rounded-lg text-xs font-bold border border-red-100">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>` 
                                                : '-'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>`;
            $('contentArea').innerHTML = html;
        }

        function renderApprove() {
            const bookings = allBookings.filter(b => b.status === 'pending');
            
            if(bookings.length === 0) {
                $('contentArea').innerHTML = `<div class="flex flex-col items-center justify-center h-full text-gray-400 fade-in"><i class="fas fa-check-circle text-6xl mb-4 text-green-100"></i><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p></div>`;
                return;
            }

            let html = `<h3 class="font-bold text-xl mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (${bookings.length})</h3><div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 fade-in">`;
            
            html += bookings.map(b => `
                <div class="bg-white rounded-2xl shadow-sm border p-6 flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-orange-400"></div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <img src="${getAvatarUrl(b)}" class="w-10 h-10 rounded-full border object-cover">
                            <div>
                                <p class="text-sm font-bold text-gray-800">${b.fullname}</p>
                                <p class="text-xs text-gray-500">User ID: ${b.user_id}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mb-4 text-sm space-y-2">
                        <p class="font-bold text-indigo-600 text-lg break-words">${b.topic}</p>
                        <p class="flex items-center gap-2 text-gray-600"><i class="fas fa-door-open w-5 text-center"></i> ${b.room_name}</p>
                        <p class="flex items-center gap-2 text-gray-600"><i class="far fa-clock w-5 text-center"></i> ${new Date(b.start_time).toLocaleString('th-TH')}</p>
                        ${b.document ? `<p class="flex items-center gap-2 text-indigo-600"><i class="fas fa-file-alt w-5 text-center"></i> <a href="${API_BASE_URL.replace('/api','')}/uploads/${b.document}" target="_blank" class="underline">‡∏î‡∏π‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏ö</a></p>` : ''}
                        <p class="flex items-center gap-2 text-gray-600 text-xs"><i class="fas fa-tools w-5 text-center"></i> ${b.equipment || '-'}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-auto">
                        <button onclick="updateBookingStatus(${b.id}, 'approved')" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded-xl font-bold shadow transition">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button onclick="updateBookingStatus(${b.id}, 'rejected')" class="bg-white border border-red-200 text-red-500 hover:bg-red-50 py-2 rounded-xl font-bold transition">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    </div>
                </div>
            `).join('');
            
            html += `</div>`;
            $('contentArea').innerHTML = html;
        }

        async function renderRooms() {
            await fetchRooms();
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
                    <button onclick="handleAddRoom()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-indigo-700">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in">
            `;
            
            html += allRooms.map(r => `
                <div class="bg-white rounded-2xl border shadow-sm overflow-hidden group">
                    <div class="h-32 bg-gradient-to-r from-gray-500 to-slate-500 flex items-center justify-center text-white text-4xl relative">
                        <i class="fas fa-door-open opacity-50"></i>
                        <button onclick="handleDeleteRoom(${r.id})" class="absolute top-2 right-2 bg-white/20 hover:bg-red-500 text-white p-2 rounded-lg backdrop-blur transition"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="p-5">
                        <h4 class="font-bold text-lg text-gray-800">${r.name}</h4>
                        <div class="flex items-center gap-2 text-sm text-gray-500 mt-1 mb-4">
                            <span><i class="fas fa-user-friends"></i> ${r.capacity} ‡∏Ñ‡∏ô</span>
                            <span>‚Ä¢</span>
                            <span>${r.facilities || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            html += `</div>`;
            $('contentArea').innerHTML = html;
        }

        async function renderUsers() {
            const res = await fetch(`${API_BASE_URL}/admin/users`);
            const users = await res.json();
            
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                </div>
                <div class="bg-white rounded-3xl shadow-sm border overflow-hidden fade-in">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm whitespace-nowrap">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4 pl-6">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                    <th class="p-4">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                                    <th class="p-4">Username</th>
                                    <th class="p-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${users.map(u => `
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-4 pl-6 flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full bg-gray-200 overflow-hidden">
                                                <img src="${getAvatarUrl(u)}" class="w-full h-full object-cover">
                                            </div>
                                            <span class="font-bold text-gray-700">${u.fullname}</span>
                                        </td>
                                        <td class="p-4">
                                            <span class="${u.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-600'} px-3 py-1 rounded-full text-xs font-bold uppercase">
                                                ${u.role}
                                            </span>
                                        </td>
                                        <td class="p-4 font-mono text-xs text-gray-500">${u.username}</td>
                                        <td class="p-4 text-right">
                                            ${u.id !== currentUser.id ? 
                                            `<button onclick="handleDeleteUser(${u.id})" class="text-red-400 hover:bg-red-50 p-2 rounded-lg transition"><i class="fas fa-trash"></i></button>` 
                                            : '<span class="text-xs text-gray-300">Current</span>'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            $('contentArea').innerHTML = html;
        }

        // --- ACTIONS & MODAL ---

        async function openBookingModal() {
            $('bookingModal').classList.remove('hidden');
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            $('bkStart').min = now.toISOString().slice(0,16);
            
            const list = $('roomList');
            list.innerHTML = '<p class="text-center text-gray-400 mt-4">Loading...</p>';
            
            await fetchRooms();
            
            list.innerHTML = allRooms.map(r => `
                <div class="border rounded-2xl p-4 flex flex-col sm:flex-row justify-between items-center gap-4 hover:border-indigo-500 hover:bg-indigo-50/20 transition cursor-pointer group" onclick="confirmBooking(${r.id}, '${r.name}')">
                    <div class="flex items-center gap-4 w-full">
                        <div class="w-12 h-12 rounded-xl bg-indigo-100 flex items-center justify-center text-indigo-600 flex-shrink-0"><i class="fas fa-door-open"></i></div>
                        <div>
                            <h5 class="font-bold text-gray-800">${r.name}</h5>
                            <p class="text-xs text-gray-500"><i class="fas fa-users"></i> ${r.capacity} ‡∏Ñ‡∏ô | ${r.facilities || '-'}</p>
                        </div>
                    </div>
                    <button class="w-full sm:w-auto bg-white border text-indigo-600 px-4 py-2 rounded-xl text-xs font-bold group-hover:bg-indigo-600 group-hover:text-white transition">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                </div>
            `).join('');
        }
        
        function closeModal() { $('bookingModal').classList.add('hidden'); }

        async function confirmBooking(roomId, roomName) {
            const topic = $('bkTopic').value;
            const startStr = $('bkStart').value;
            const duration = $('bkDuration').value;
            const people = $('bkPeople').value;
            const fileInput = $('bkFile');
            const equipment = [...document.querySelectorAll('.equip input:checked')].map(e=>e.value).join(', ');

            if(!topic || !startStr) { Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°', 'warning'); return; }

            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                text: `‡∏´‡πâ‡∏≠‡∏á: ${roomName} \n‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: ${topic}`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            });

            if(!result.isConfirmed) return;

            const formData = new FormData();
            formData.append('userId', currentUser.id);
            formData.append('roomId', roomId);
            formData.append('topic', topic);
            formData.append('start', startStr);
            formData.append('duration', duration);
            formData.append('people', people);
            formData.append('equipment', equipment);

            if(fileInput.files[0]) {
                formData.append('document', fileInput.files[0]);
            }

            try {
                const res = await fetch(`${API_BASE_URL}/book`, {
                    method: 'POST',
                    body: formData 
                });
                const data = await res.json();
                
                if(data.success) {
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'success');
                    closeModal();
                    renderPage('home');
                } else {
                    Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', data.message || '‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
                }
            } catch(e) {
                console.error(e);
                Swal.fire('Error', 'Connection Error', 'error');
            }
        }

        async function updateBookingStatus(id, status) {
            try {
                const res = await fetch(`${API_BASE_URL}/admin/bookings/${id}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ status })
                });
                const data = await res.json();
                if(data.success) {
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ${status}`, 'success');
                    renderPage('approve');
                }
            } catch(e) { Swal.fire('Error', 'Failed', 'error'); }
        }

        async function deleteBooking(id) {
            const confirm = await Swal.fire({title:'‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á?', icon:'warning', showCancelButton:true});
            if(confirm.isConfirmed) {
                await fetch(`${API_BASE_URL}/bookings/${id}`, { method: 'DELETE' });
                renderPage('history');
            }
        }

        // --- ADMIN MANAGEMENT ---
        async function handleAddRoom() {
            const { value: formValues } = await Swal.fire({
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°',
                html:
                    '<input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á">' +
                    '<input id="swal-cap" type="number" class="swal2-input" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏ (‡∏Ñ‡∏ô)">' +
                    '<input id="swal-fac" class="swal2-input" placeholder="‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å">',
                focusConfirm: false,
                preConfirm: () => {
                    return {
                        name: document.getElementById('swal-name').value,
                        capacity: document.getElementById('swal-cap').value,
                        facilities: document.getElementById('swal-fac').value
                    }
                }
            });

            if (formValues) {
                await fetch(`${API_BASE_URL}/admin/rooms`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(formValues)
                });
                renderPage('rooms');
            }
        }

        async function handleDeleteRoom(id) {
            const c = await Swal.fire({title:'‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?',text:'‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏î‡πâ‡∏ß‡∏¢',icon:'warning',showCancelButton:true});
            if(c.isConfirmed) {
                await fetch(`${API_BASE_URL}/admin/rooms/${id}`, { method: 'DELETE' });
                renderPage('rooms');
            }
        }

        async function handleDeleteUser(id) {
            const c = await Swal.fire({title:'‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?',text:'‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ',icon:'warning',showCancelButton:true});
            if(c.isConfirmed) {
                await fetch(`${API_BASE_URL}/admin/users/${id}`, { method: 'DELETE' });
                renderPage('users');
            }
        }

        // --- UTILS ---
        function getStatusBadge(s) {
            if(s==='approved') return '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>';
            if(s==='pending') return '<span class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
            return '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>';
        }

        function toggleSidebar() {
            const sb = $('sidebar');
            const overlay = $('sidebarOverlay');
            
            if (sb.classList.contains('-translate-x-full')) {
                // Open
                sb.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                // Close
                sb.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
