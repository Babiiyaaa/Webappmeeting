<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppMeeting - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° (Demo)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; background-color: #f8fafc; }
        .hidden-section { display: none !important; }
        .nav-btn.active { background-color: #eff6ff; color: #4f46e5; border-right: 4px solid #4f46e5; font-weight: 600; }
        .equip input:checked + div {
            background: #eef2ff; border-color: #6366f1; color: #4338ca; font-weight: 600;
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #bookingModal { z-index: 10000 !important; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
    </style>
</head>
<body class="h-screen overflow-hidden text-gray-700 bg-gray-50">
    <script>
        const API_BASE_URL = 'https://webappmeeting-fixenv.onrender.com/api'; // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    </script>
    <!-- LOGIN SCREEN -->
    <div id="authSection" class="h-full flex items-center justify-center bg-slate-900 relative overflow-hidden">
        <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1920&q=80')] bg-cover bg-center"></div>
        <div class="bg-white/95 backdrop-blur p-8 rounded-3xl shadow-2xl w-full max-w-sm relative z-10 mx-4">
            <h2 class="text-3xl font-bold text-center mb-2 text-indigo-700">AppMeeting</h2>
            <p class="text-center text-gray-400 text-sm mb-6">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
            
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">USERNAME</label>
                    <input id="lUser" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition" placeholder="admin ‡∏´‡∏£‡∏∑‡∏≠ user" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 mb-1">PASSWORD</label>
                    <input id="lPass" type="password" class="w-full p-3 border rounded-xl bg-gray-50 focus:bg-white outline-none focus:ring-2 ring-indigo-500 transition" placeholder="1234" required>
                </div>
                <button class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg transform active:scale-95">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>

            <div class="mt-6 pt-6 border-t border-gray-100 text-xs text-gray-500">
                <p class="font-bold mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Demo):</p>
                <div class="flex justify-between items-center mb-1">
                    <span>üëë Admin:</span> 
                    <code class="bg-gray-100 px-2 py-1 rounded select-all cursor-pointer" onclick="fillLogin('admin','1234')">admin / 1234</code>
                </div>
                <div class="flex justify-between items-center">
                    <span>üë§ User:</span> 
                    <code class="bg-gray-100 px-2 py-1 rounded select-all cursor-pointer" onclick="fillLogin('user','1234')">user / 1234</code>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="appSection" class="hidden-section flex h-full">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-xl z-20 flex flex-col border-r border-gray-100 transition-all duration-300" id="sidebar">
            <div class="p-6 border-b flex justify-between items-center">
                <h1 class="font-bold text-xl text-indigo-600 tracking-tight">AppMeeting</h1>
                <span class="text-[10px] bg-indigo-50 text-indigo-500 px-2 py-1 rounded border border-indigo-100">v2.1</span>
            </div>
            
            <!-- User Profile Widget -->
            <div class="p-6 text-center border-b bg-gradient-to-b from-white to-slate-50">
                <div class="relative inline-block">
                    <img id="sideAvatar" src="" class="w-20 h-20 rounded-full mx-auto mb-3 object-cover border-4 border-white shadow-md">
                    <div id="statusDot" class="absolute bottom-2 right-0 w-5 h-5 bg-green-500 border-4 border-white rounded-full"></div>
                </div>
                <h3 id="sideName" class="font-bold text-gray-800 text-lg leading-tight">...</h3>
                <span id="sideRole" class="text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-gray-400">...</span>
            </div>

            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <p class="px-3 text-[10px] font-bold text-gray-400 uppercase mb-2 mt-2">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</p>
                <button onclick="renderPage('home')" class="nav-btn active w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="home">
                    <div class="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center"><i class="fas fa-home"></i></div>
                    ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
                <button onclick="renderPage('calendar')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="calendar">
                    <div class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fas fa-calendar-alt"></i></div>
                    ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏à‡∏≠‡∏á
                </button>
                <button onclick="openBookingModal()" class="w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm group">
                    <div class="w-8 h-8 rounded-lg bg-indigo-600 text-white flex items-center justify-center shadow-md group-hover:scale-110 transition"><i class="fas fa-plus"></i></div>
                    <span class="font-bold text-indigo-700">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</span>
                </button>
                <button onclick="renderPage('history')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-indigo-50 flex gap-3 transition items-center text-sm" data-page="history">
                    <div class="w-8 h-8 rounded-lg bg-purple-100 text-purple-600 flex items-center justify-center"><i class="fas fa-history"></i></div>
                    ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
                
                <!-- Admin Menu -->
                <div id="adminMenu" class="hidden-section mt-6 pt-4 border-t border-dashed">
                    <p class="px-3 text-[10px] font-bold text-gray-400 uppercase mb-2">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                    <button onclick="renderPage('approve')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-orange-50 text-orange-600 flex gap-3 items-center text-sm" data-page="approve">
                        <div class="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center"><i class="fas fa-tasks"></i></div>
                        ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á <span id="badgePending" class="hidden ml-auto bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full">0</span>
                    </button>
                    <button onclick="renderPage('rooms')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-teal-50 text-teal-600 flex gap-3 items-center text-sm" data-page="rooms">
                        <div class="w-8 h-8 rounded-lg bg-teal-100 text-teal-600 flex items-center justify-center"><i class="fas fa-door-open"></i></div>
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á
                    </button>
                    <button onclick="renderPage('users')" class="nav-btn w-full text-left p-3 rounded-xl hover:bg-blue-50 text-blue-600 flex gap-3 items-center text-sm" data-page="users">
                        <div class="w-8 h-8 rounded-lg bg-blue-100 text-blue-600 flex items-center justify-center"><i class="fas fa-users-cog"></i></div>
                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    </button>
                </div>
            </nav>
            <div class="p-4 border-t bg-gray-50">
                <button onclick="logout()" class="w-full text-gray-500 hover:text-red-500 hover:bg-red-50 p-2 rounded-xl font-bold text-sm transition flex items-center justify-center gap-2">
                    <i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col bg-slate-50 overflow-hidden relative">
            <header class="h-16 bg-white border-b px-6 flex items-center justify-between sticky top-0 z-10 shadow-sm">
                <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 rounded-lg hover:bg-gray-100"><i class="fas fa-bars"></i></button>
                    <h2 id="pageTitle" class="text-xl font-bold text-gray-800">Dashboard</h2>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right hidden md:block">
                        <p id="dateDisplay" class="text-sm font-bold text-gray-700"></p>
                        <p id="timeDisplay" class="text-xs text-gray-500"></p>
                    </div>
                </div>
            </header>
            
            <div id="contentArea" class="flex-1 p-6 md:p-8 overflow-y-auto pb-20">
                <!-- Content Injected Here -->
            </div>
        </main>
    </div>

    <!-- BOOKING MODAL -->
    <div id="bookingModal" class="hidden fixed inset-0 bg-slate-900/70 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-5xl h-[85vh] rounded-3xl shadow-2xl flex flex-col md:flex-row overflow-hidden fade-in">
            <!-- Left: Form -->
            <div class="w-full md:w-1/3 bg-slate-50 p-6 md:p-8 border-r overflow-y-auto flex flex-col">
                <h3 class="text-xl font-bold mb-1 text-gray-800">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h3>
                <p class="text-xs text-gray-400 mb-6">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</p>
                
                <div class="space-y-4 flex-1">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="text-red-500">*</span></label>
                        <input id="bkTopic" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô..." class="w-full p-3 border rounded-xl focus:ring-2 ring-indigo-500 outline-none bg-white">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</label>
                        <input id="bkPeople" type="number" min="1" value="5" class="w-full p-3 border rounded-xl outline-none bg-white">
                    </div>
                    <div class="grid grid-cols-1 gap-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="text-red-500">*</span></label>
                            <input id="bkStart" type="datetime-local" class="w-full p-3 border rounded-xl outline-none bg-white">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 uppercase block mb-1">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                            <select id="bkDuration" class="w-full p-3 border rounded-xl outline-none bg-white">
                                <option value="1">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="2" selected>2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="3">3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="4">4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                <option value="8">‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô (8 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase block mb-2">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="equip"><input type="checkbox" value="WiFi" checked hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-wifi mr-1"></i> WiFi</div></label>
                            <label class="equip"><input type="checkbox" value="Projector" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-video mr-1"></i> Projector</div></label>
                            <label class="equip"><input type="checkbox" value="Whiteboard" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-chalkboard mr-1"></i> Board</div></label>
                            <label class="equip"><input type="checkbox" value="Snack" hidden><div class="p-2 border rounded-lg text-center cursor-pointer text-xs hover:bg-gray-100 transition"><i class="fas fa-cookie-bite mr-1"></i> Snack</div></label>
                        </div>
                    </div>
                </div>
                
                <div class="pt-4 mt-4 border-t">
                    <button onclick="closeModal()" class="w-full py-2 text-gray-400 text-sm font-bold hover:text-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
            
            <!-- Right: Room Select -->
            <div class="w-full md:w-2/3 bg-white p-6 md:p-8 flex flex-col relative">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-bold text-gray-700 text-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h4>
                    <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full"><i class="fas fa-check-circle mr-1"></i>‡πÅ‡∏™‡∏î‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á</span>
                </div>
                <div id="roomList" class="flex-1 overflow-y-auto space-y-3 pr-2 pb-20">
                    <!-- Room Items Injected Here -->
                </div>
                
                <!-- Bottom Action Bar (Mobile/Desktop) -->
                <div class="absolute bottom-0 left-0 right-0 p-4 bg-white border-t flex justify-end">
                     <!-- Action buttons are inside the room items for better UX -->
                </div>
            </div>
        </div>
    </div>

    <!-- MOCK DATA & LOGIC ENGINE -->
    <script>
        // --- 1. MOCK DATABASE ENGINE (LocalStorage) ---
        const DB = {
            init: () => {
                if(!localStorage.getItem('am_users')) {
                    localStorage.setItem('am_users', JSON.stringify([
                        { id: 1, username: 'admin', password: '123', fullname: 'Administrator', role: 'admin', avatar: 'https://ui-avatars.com/api/?name=Admin&background=0f172a&color=fff' },
                        { id: 2, username: 'user', password: '123', fullname: 'Somchai User', role: 'user', avatar: 'https://ui-avatars.com/api/?name=Somchai&background=4f46e5&color=fff' }
                    ]));
                }
                if(!localStorage.getItem('am_rooms')) {
                    localStorage.setItem('am_rooms', JSON.stringify([
                        { id: 101, name: 'Grand Meeting Room', capacity: 50, facilities: 'Projector, WiFi, Sound System', image: 'bg-gradient-to-r from-blue-500 to-cyan-500' },
                        { id: 102, name: 'Focus Room A', capacity: 10, facilities: 'WiFi, Whiteboard', image: 'bg-gradient-to-r from-purple-500 to-pink-500' },
                        { id: 103, name: 'Creative Space', capacity: 20, facilities: 'Beanbags, WiFi, TV', image: 'bg-gradient-to-r from-orange-500 to-yellow-500' }
                    ]));
                }
                if(!localStorage.getItem('am_bookings')) {
                    // Seed some initial data
                    const today = new Date().toISOString().split('T')[0];
                    localStorage.setItem('am_bookings', JSON.stringify([
                        { id: 1, userId: 2, roomId: 101, topic: 'Monthly Plan', start: `${today}T10:00`, end: `${today}T12:00`, status: 'approved', people: 10 },
                        { id: 2, userId: 2, roomId: 102, topic: 'Team Sync', start: `${today}T14:00`, end: `${today}T15:00`, status: 'pending', people: 5 }
                    ]));
                }
            },
            getUsers: () => JSON.parse(localStorage.getItem('am_users')),
            getRooms: () => JSON.parse(localStorage.getItem('am_rooms')),
            getBookings: () => JSON.parse(localStorage.getItem('am_bookings')),
            
            saveUsers: (data) => localStorage.setItem('am_users', JSON.stringify(data)),
            saveRooms: (data) => localStorage.setItem('am_rooms', JSON.stringify(data)),
            saveBookings: (data) => localStorage.setItem('am_bookings', JSON.stringify(data)),
            
            // Logic
            login: (u, p) => DB.getUsers().find(user => user.username === u && (user.password === p || p === '1234')), // Allow 1234 for demo
            
            addBooking: (booking) => {
                const list = DB.getBookings();
                booking.id = Date.now();
                booking.status = 'pending'; 
                list.push(booking);
                DB.saveBookings(list);
                return booking;
            },
            
            updateBookingStatus: (id, status) => {
                const list = DB.getBookings();
                const idx = list.findIndex(b => b.id == id);
                if(idx > -1) {
                    list[idx].status = status;
                    DB.saveBookings(list);
                    return true;
                }
                return false;
            },
            
            deleteBooking: (id) => {
                let list = DB.getBookings();
                list = list.filter(b => b.id != id);
                DB.saveBookings(list);
            },

            addRoom: (room) => {
                const list = DB.getRooms();
                room.id = Date.now();
                list.push(room);
                DB.saveRooms(list);
            },
            
            deleteRoom: (id) => {
                let list = DB.getRooms();
                list = list.filter(r => r.id != id);
                DB.saveRooms(list);
            },

            addUser: (user) => {
                const list = DB.getUsers();
                user.id = Date.now();
                // Generate Avatar
                if(!user.avatar) user.avatar = `https://ui-avatars.com/api/?name=${user.fullname}&background=random&color=fff`;
                list.push(user);
                DB.saveUsers(list);
            },

            deleteUser: (id) => {
                let list = DB.getUsers();
                list = list.filter(u => u.id != id);
                DB.saveUsers(list);
            }
        };

        // --- 2. APP LOGIC ---
        let currentUser = null;
        const $ = id => document.getElementById(id);
        
        // Init
        DB.init();
        window.onload = () => {
            const savedUser = localStorage.getItem('am_currentUser');
            if(savedUser) {
                currentUser = JSON.parse(savedUser);
                initUI();
            }
            updateClock();
            setInterval(updateClock, 60000);
        };

        function updateClock() {
            const now = new Date();
            if($('dateDisplay')) $('dateDisplay').innerText = now.toLocaleDateString('th-TH', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
            if($('timeDisplay')) $('timeDisplay').innerText = now.toLocaleTimeString('th-TH', { hour:'2-digit', minute:'2-digit' });
        }

        // Auth
        function fillLogin(u,p) { $('lUser').value=u; $('lPass').value=p; }
        
        function handleLogin(e) {
            e.preventDefault();
            const u = $('lUser').value.trim();
            const p = $('lPass').value.trim();
            const user = DB.login(u, p);
            
            if(user) {
                currentUser = user;
                localStorage.setItem('am_currentUser', JSON.stringify(user));
                initUI();
            } else {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏•‡∏≠‡∏á admin/1234 ‡∏´‡∏£‡∏∑‡∏≠ user/1234)');
            }
        }

        function logout() {
            localStorage.removeItem('am_currentUser');
            location.reload();
        }

        function initUI() {
            $('authSection').classList.add('hidden-section');
            $('appSection').classList.remove('hidden-section');
            
            // Profile Update
            $('sideName').innerText = currentUser.fullname;
            $('sideAvatar').src = currentUser.avatar;
            
            const roleEl = $('sideRole');
            if(currentUser.role === 'admin') {
                roleEl.innerText = '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö';
                roleEl.className = 'text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-indigo-600 shadow-indigo-200 shadow-lg';
                $('adminMenu').classList.remove('hidden-section');
                updateBadge();
            } else {
                roleEl.innerText = '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
                roleEl.className = 'text-xs font-bold mt-1 inline-block px-3 py-1 rounded-full text-white bg-gray-400';
            }
            
            renderPage('home');
        }

        function updateBadge() {
            if(currentUser.role !== 'admin') return;
            const pendings = DB.getBookings().filter(b => b.status === 'pending').length;
            const badge = $('badgePending');
            badge.innerText = pendings;
            if(pendings > 0) badge.classList.remove('hidden'); else badge.classList.add('hidden');
        }

        // Routing
        function renderPage(page) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.page === page) btn.classList.add('active');
            });

            const content = $('contentArea');
            $('pageTitle').innerText = 
                page === 'home' ? '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Overview)' :
                page === 'calendar' ? '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏´‡πâ‡∏≠‡∏á' :
                page === 'history' ? '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô' :
                page === 'approve' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á (Admin)' :
                page === 'users' ? '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°';

            content.innerHTML = '';
            
            if(page === 'home') renderDashboard();
            else if(page === 'calendar') renderCalendarPage();
            else if(page === 'history') renderHistory();
            else if(page === 'approve') renderApprove();
            else if(page === 'rooms') renderRooms();
            else if(page === 'users') renderUsers();
        }

        // --- PAGE RENDERERS ---

        function renderDashboard() {
            const bookings = DB.getBookings();
            const myBookings = bookings.filter(b => b.userId === currentUser.id);
            const now = new Date();
            
            // Find next approved meeting
            const nextMeeting = myBookings
                .filter(b => b.status === 'approved' && new Date(b.start) > now)
                .sort((a, b) => new Date(a.start) - new Date(b.start))[0];

            let pendingCount = bookings.filter(b => b.status === 'pending').length;
            
            let html = `<div class="fade-in max-w-6xl mx-auto space-y-8">`;
            
            // 1. Welcome & Next Meeting Card
            html += `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-3xl p-8 text-white shadow-xl relative overflow-hidden">
                        <div class="relative z-10">
                            <h2 class="text-3xl font-bold mb-2">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ‡∏Ñ‡∏∏‡∏ì${currentUser.fullname.split(' ')[0]} üëã</h2>
                            <p class="text-indigo-100 mb-8">‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                            
                            ${nextMeeting ? `
                                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                                    <div class="flex items-center gap-3 mb-2 text-indigo-200 text-xs font-bold uppercase tracking-wider">
                                        <i class="fas fa-calendar-day"></i> ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                                    </div>
                                    <h3 class="text-2xl font-bold mb-2">${nextMeeting.topic}</h3>
                                    <div class="flex flex-wrap gap-4 text-sm">
                                        <span class="flex items-center gap-2"><i class="far fa-clock"></i> ${new Date(nextMeeting.start).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})} - ${new Date(nextMeeting.end).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})}</span>
                                        <span class="flex items-center gap-2"><i class="fas fa-map-marker-alt"></i> ${getRoomName(nextMeeting.roomId)}</span>
                                    </div>
                                </div>
                            ` : `
                                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20 flex items-center gap-4">
                                    <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-xl">‚òï</div>
                                    <div>
                                        <h3 class="font-bold text-lg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</h3>
                                        <p class="text-sm text-indigo-100">‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                                    </div>
                                </div>
                            `}
                        </div>
                        <div class="absolute right-0 top-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/4 blur-3xl"></div>
                    </div>
                    
                    <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center">
                        <h4 class="font-bold text-gray-700 mb-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded-xl">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center"><i class="fas fa-check"></i></div>
                                    <div>
                                        <p class="text-xs text-gray-500 font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                        <p class="font-bold text-gray-800">${myBookings.filter(b=>b.status==='approved').length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-orange-50 rounded-xl">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center"><i class="fas fa-clock"></i></div>
                                    <div>
                                        <p class="text-xs text-gray-500 font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                        <p class="font-bold text-gray-800">${myBookings.filter(b=>b.status==='pending').length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                    </div>
                                </div>
                            </div>
                            ${currentUser.role === 'admin' ? `
                            <div class="p-3 bg-slate-900 text-white rounded-xl text-center cursor-pointer hover:bg-slate-800 transition" onclick="renderPage('approve')">
                                <p class="text-xs text-gray-400">ADMIN ONLY</p>
                                <p class="font-bold">‡∏£‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ${pendingCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                            </div>` : ''}
                        </div>
                    </div>
                </div>`;
                
            // 2. Recent Bookings Table
            html += `
                <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
                    <div class="p-6 border-b flex justify-between items-center">
                        <h3 class="font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                        <button onclick="renderPage('history')" class="text-sm text-indigo-600 hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4 pl-6">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                    <th class="p-4">‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th class="p-4">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="p-4 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${myBookings.length > 0 ? myBookings.slice(0, 5).reverse().map(b => `
                                    <tr class="hover:bg-slate-50 transition">
                                        <td class="p-4 pl-6 font-bold text-gray-700">${b.topic}</td>
                                        <td class="p-4 text-gray-600">${getRoomName(b.roomId)}</td>
                                        <td class="p-4 text-gray-500 text-xs">
                                            ${new Date(b.start).toLocaleDateString('th-TH', {day:'numeric',month:'short'})}<br>
                                            ${new Date(b.start).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})} - ${new Date(b.end).toLocaleTimeString('th-TH', {hour:'2-digit',minute:'2-digit'})}
                                        </td>
                                        <td class="p-4 text-center">${getStatusBadge(b.status)}</td>
                                    </tr>
                                `).join('') : `<tr><td colspan="4" class="p-8 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</td></tr>`}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>`;
            
            $('contentArea').innerHTML = html;
        }

        function renderCalendarPage() {
            $('contentArea').innerHTML = `<div class="bg-white p-4 rounded-3xl shadow-sm border h-[600px] fade-in"><div id="calendar" class="h-full"></div></div>`;
            
            const bookings = DB.getBookings();
            const events = bookings.map(b => {
                const isMine = b.userId === currentUser.id;
                let color = '#9ca3af'; // Default gray
                
                if (b.status === 'approved') {
                    color = isMine ? '#4f46e5' : '#10b981'; // Mine=Indigo, Others=Green
                } else if (b.status === 'pending') {
                    color = '#f59e0b'; // Orange
                } else if (b.status === 'rejected') {
                    color = '#ef4444'; // Red
                }

                return {
                    title: `${b.topic} (${getRoomName(b.roomId)})`,
                    start: b.start,
                    end: b.end,
                    backgroundColor: color,
                    borderColor: 'transparent',
                    extendedProps: { status: b.status, user: getUserName(b.userId) }
                };
            });

            setTimeout(() => {
                const calendar = new FullCalendar.Calendar($('calendar'), {
                    initialView: 'timeGridWeek',
                    locale: 'th',
                    headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay' },
                    events: events,
                    height: '100%',
                    slotMinTime: '08:00:00',
                    slotMaxTime: '19:00:00',
                    eventClick: function(info) {
                        alert(`‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${info.event.title}\n‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á: ${info.event.extendedProps.user}\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${info.event.extendedProps.status}`);
                    }
                });
                calendar.render();
            }, 100);
        }

        function renderApprove() {
            const bookings = DB.getBookings().filter(b => b.status === 'pending');
            
            if(bookings.length === 0) {
                $('contentArea').innerHTML = `<div class="flex flex-col items-center justify-center h-full text-gray-400 fade-in"><i class="fas fa-check-circle text-6xl mb-4 text-green-100"></i><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p></div>`;
                return;
            }

            let html = `<h3 class="font-bold text-xl mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (${bookings.length})</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in">`;
            
            html += bookings.map(b => `
                <div class="bg-white rounded-2xl shadow-sm border p-6 flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-orange-400"></div>
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <img src="${getUserAvatar(b.userId)}" class="w-10 h-10 rounded-full border">
                            <div>
                                <p class="text-sm font-bold text-gray-800">${getUserName(b.userId)}</p>
                                <p class="text-xs text-gray-500">‡∏Ç‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mb-4 text-sm space-y-2">
                        <p class="font-bold text-indigo-600 text-lg">${b.topic}</p>
                        <p class="flex items-center gap-2 text-gray-600"><i class="fas fa-door-open w-5 text-center"></i> ${getRoomName(b.roomId)}</p>
                        <p class="flex items-center gap-2 text-gray-600"><i class="far fa-clock w-5 text-center"></i> ${new Date(b.start).toLocaleString('th-TH')}</p>
                        <p class="flex items-center gap-2 text-gray-600"><i class="fas fa-users w-5 text-center"></i> ${b.people} ‡∏ó‡πà‡∏≤‡∏ô</p>
                        <p class="flex items-center gap-2 text-gray-600 text-xs"><i class="fas fa-tools w-5 text-center"></i> ${b.equips || '-'}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mt-auto">
                        <button onclick="updateBooking(${b.id}, 'approved')" class="bg-green-500 hover:bg-green-600 text-white py-2 rounded-xl font-bold shadow transition">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                        <button onclick="updateBooking(${b.id}, 'rejected')" class="bg-white border border-red-200 text-red-500 hover:bg-red-50 py-2 rounded-xl font-bold transition">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                    </div>
                </div>
            `).join('');
            
            html += `</div>`;
            $('contentArea').innerHTML = html;
        }

        function renderRooms() {
            const rooms = DB.getRooms();
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h3>
                    <button onclick="addNewRoom()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-indigo-700">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 fade-in">
            `;
            
            html += rooms.map(r => `
                <div class="bg-white rounded-2xl border shadow-sm overflow-hidden group">
                    <div class="h-32 ${r.image || 'bg-gray-200'} flex items-center justify-center text-white text-4xl relative">
                        <i class="fas fa-door-open opacity-50 group-hover:scale-110 transition duration-500"></i>
                        <button onclick="deleteRoom(${r.id})" class="absolute top-2 right-2 bg-white/20 hover:bg-red-500 text-white p-2 rounded-lg backdrop-blur transition"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="p-5">
                        <h4 class="font-bold text-lg text-gray-800">${r.name}</h4>
                        <div class="flex items-center gap-2 text-sm text-gray-500 mt-1 mb-4">
                            <span><i class="fas fa-user-friends"></i> ${r.capacity} ‡∏Ñ‡∏ô</span>
                            <span>‚Ä¢</span>
                            <span>${r.facilities}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            html += `</div>`;
            $('contentArea').innerHTML = html;
        }

        function renderUsers() {
            const users = DB.getUsers();
            let html = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                    <button onclick="addNewUser()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl text-sm font-bold shadow hover:bg-indigo-700">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                </div>
                <div class="bg-white rounded-3xl shadow-sm border overflow-hidden fade-in">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4 pl-6">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                    <th class="p-4">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                                    <th class="p-4">Username</th>
                                    <th class="p-4 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${users.map(u => `
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-4 pl-6 flex items-center gap-3">
                                            <img src="${u.avatar}" class="w-10 h-10 rounded-full border">
                                            <span class="font-bold text-gray-700">${u.fullname}</span>
                                        </td>
                                        <td class="p-4">
                                            <span class="${u.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-600'} px-3 py-1 rounded-full text-xs font-bold uppercase">
                                                ${u.role}
                                            </span>
                                        </td>
                                        <td class="p-4 font-mono text-xs text-gray-500">${u.username}</td>
                                        <td class="p-4 text-right">
                                            ${u.id !== currentUser.id ? 
                                            `<button onclick="deleteUser(${u.id})" class="text-red-400 hover:bg-red-50 p-2 rounded-lg transition"><i class="fas fa-trash"></i></button>` 
                                            : '<span class="text-xs text-gray-300">Current</span>'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            $('contentArea').innerHTML = html;
        }

        function renderHistory() {
            const bookings = DB.getBookings().filter(b => b.userId === currentUser.id).reverse();
            let html = `
                <div class="bg-white rounded-3xl shadow-sm border p-6 fade-in">
                    <h3 class="font-bold text-lg mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-gray-50 text-gray-500 uppercase text-xs">
                                <tr>
                                    <th class="p-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="p-4">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th class="p-4">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</th>
                                    <th class="p-4">‡∏´‡πâ‡∏≠‡∏á</th>
                                    <th class="p-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="p-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                ${bookings.map(b => `
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-4">${new Date(b.start).toLocaleDateString('th-TH')}</td>
                                        <td class="p-4">${new Date(b.start).toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})} - ${new Date(b.end).toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})}</td>
                                        <td class="p-4 font-bold text-gray-700">${b.topic}</td>
                                        <td class="p-4">${getRoomName(b.roomId)}</td>
                                        <td class="p-4">${getStatusBadge(b.status)}</td>
                                        <td class="p-4">
                                            ${b.status === 'pending' ? `<button onclick="deleteBooking(${b.id})" class="text-red-500 hover:bg-red-50 px-3 py-1 rounded-lg text-xs font-bold border border-red-100">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>` : '-'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>`;
            $('contentArea').innerHTML = html;
        }

        // --- ACTIONS ---

        function openBookingModal() {
            $('bookingModal').classList.remove('hidden');
            $('bkStart').min = new Date().toISOString().slice(0,16); // Prevent past dates
            renderRoomList();
        }
        
        function closeModal() { $('bookingModal').classList.add('hidden'); }

        function renderRoomList() {
            const rooms = DB.getRooms();
            const list = $('roomList');
            list.innerHTML = rooms.map(r => `
                <div class="border rounded-2xl p-4 flex justify-between items-center hover:border-indigo-500 hover:bg-indigo-50/20 transition cursor-pointer group" onclick="selectRoom(${r.id})">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl ${r.image} flex items-center justify-center text-white"><i class="fas fa-door-open"></i></div>
                        <div>
                            <h5 class="font-bold text-gray-800">${r.name}</h5>
                            <p class="text-xs text-gray-500"><i class="fas fa-users"></i> ${r.capacity} ‡∏Ñ‡∏ô | ${r.facilities}</p>
                        </div>
                    </div>
                    <button class="bg-white border text-indigo-600 px-4 py-2 rounded-xl text-xs font-bold group-hover:bg-indigo-600 group-hover:text-white transition">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                </div>
            `).join('');
        }

        function selectRoom(roomId) {
            // Validation
            const topic = $('bkTopic').value;
            const startStr = $('bkStart').value;
            const duration = parseInt($('bkDuration').value);
            const people = $('bkPeople').value;

            if(!topic || !startStr) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°'); return; }

            // Calc End Time
            const start = new Date(startStr);
            const end = new Date(start.getTime() + duration * 60 * 60 * 1000);
            const equip = [...document.querySelectorAll('.equip input:checked')].map(e=>e.value).join(', ');

            // Conflict Check (Simulated)
            const conflict = DB.getBookings().some(b => 
                b.roomId === roomId && 
                b.status === 'approved' &&
                ((new Date(b.start) < end) && (new Date(b.end) > start))
            );

            if(conflict) {
                alert('‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏±‡∏á‡∏Å‡∏•‡πà‡∏≤‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô');
                return;
            }

            const booking = {
                userId: currentUser.id,
                roomId: roomId,
                topic: topic,
                people: people,
                start: start.toISOString(),
                end: end.toISOString(),
                equips: equip
            };

            DB.addBooking(booking);
            alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
            closeModal();
            updateBadge();
            renderPage('home');
        }

        function updateBooking(id, status) {
            if(DB.updateBookingStatus(id, status)) {
                updateBadge();
                renderPage('approve'); // Refresh
            }
        }

        function deleteBooking(id) {
            if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                DB.deleteBooking(id);
                updateBadge();
                renderPage('history');
            }
        }

        function addNewRoom() {
            const name = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°:');
            if(name) {
                DB.addRoom({
                    name: name,
                    capacity: 10,
                    facilities: 'Standard',
                    image: 'bg-gradient-to-r from-gray-500 to-slate-500'
                });
                renderPage('rooms');
            }
        }

        function addNewUser() {
            const fullname = prompt('‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:');
            if(!fullname) return;
            const username = prompt('Username:');
            if(!username) return;
            const password = prompt('Password:');
            if(!password) return;
            const isAdmin = confirm('‡∏Å‡∏î‡∏ï‡∏Å‡∏•‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Admin\n‡∏Å‡∏î "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö User ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ');
            
            DB.addUser({
                fullname,
                username,
                password,
                role: isAdmin ? 'admin' : 'user'
            });
            renderPage('users');
        }
        
        function deleteRoom(id) {
            if(confirm('‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) {
                DB.deleteRoom(id);
                renderPage('rooms');
            }
        }

        function deleteUser(id) {
            if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                DB.deleteUser(id);
                renderPage('users');
            }
        }

        // --- UTILS ---
        function getRoomName(id) { const r = DB.getRooms().find(x=>x.id==id); return r ? r.name : 'Unknown Room'; }
        function getUserName(id) { const u = DB.getUsers().find(x=>x.id==id); return u ? u.fullname : 'Unknown User'; }
        function getUserAvatar(id) { const u = DB.getUsers().find(x=>x.id==id); return u ? u.avatar : ''; }
        function getStatusBadge(s) {
            if(s==='approved') return '<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>';
            if(s==='pending') return '<span class="bg-orange-100 text-orange-700 px-3 py-1 rounded-full text-xs font-bold">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
            return '<span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
        }

        function toggleSidebar() {
            const sb = $('sidebar');
            sb.classList.toggle('-translate-x-full');
            sb.classList.toggle('fixed');
            sb.classList.toggle('h-full');
            sb.classList.toggle('z-50');
        }
    </script>
</body>
</html>
